(function(a,b){var c={};c.map=function(a,d){var e=arguments[2];if(a.map!==b)return a.map(d,e);var f=a.length;if(!c.isFunction(d))throw new TypeError;var g=new Array(f);for(var h=0;h<f;h++){if(h in a)g[h]=d.call(e,a[h],h,a)}return g};c.filter=function(a,d){var e=arguments[2];if(a.filter!==b)return a.filter(d,e);var f=a.length;if(!c.isFunction(d))throw new TypeError;var g=new Array;for(var h=0;h<f;h++){if(h in a){var i=a[h];if(d.call(e,i,h,a))g.push(i)}}return g};c.every=function(a,d){var e=arguments[2];if(a.every!==b)return a.every(d,e);var f=a.length;if(!c.isFunction(d))throw new TypeError;for(var g=0;g<f;g++){if(g in a&&!d.call(e,a[g],g,a))return false}return true};c.some=function(a,c){var d=arguments[2];if(a.some!==b)return a.some(c,d);var e=a.length;for(var f=0;f<e;f++){if(f in a&&c.call(d,a[f],f,a))return true}return false};c.isFunction=function(a){return typeof a=="function"};c.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"};c.extendDeferredSort=function(a,b){var c=function(a){return{keySelector:a.keySelector,comparer:a.comparer,reverse:a.reverse,next:a.next==null?b:c(a.next)}};return c(a)};c.createLambda=function(a){if(c.isFunction(a))return a;if(typeof a==typeof ""&&a!==""){if(a.indexOf("=>")<0)return new Function("$,$$,$$$","return "+a);var b=a.match(/^\s*\(?\s*([^)]*)\s*\)?\s*=>(.*)/);return new Function(b[1],"return "+b[2])}return a};c.processDeferredSort=function(a){if(a.deferredSort==null)return;var b=function(a,c,d){var e;if(d.reverse)e=d.comparer(d.keySelector(c),d.keySelector(a));else e=d.comparer(d.keySelector(a),d.keySelector(c));if(e==0){if(d.next==null)return 0;return b(a,c,d.next)}else return e};a.array.sort(function(c,d){return b(c,d,a.deferredSort)});a.deferredSort=null};c.identity=function(a){return a};var d=function(a){var b=true;if(arguments.length>=1&&arguments[1]!=null&&!arguments[1])b=false;if(b)this.array=a==null?[]:a.slice(0);else this.array=a;this.deferredSort=null};d.from=function(a){if(a==null)return new d([]);if(a instanceof d)return a;if(c.isArray(a))return new d(a);if(jQuery&&a instanceof jQuery)return new d($.makeArray(a));return new d([a],false)};d.range=function(a,b,c){if(a==null||isNaN(a))throw new Error("Invalid 'from' value.");if(b==null||isNaN(b))throw new Error("Invalid 'to' value.");if(c==null||isNaN(c))c=1;var e=[];for(var f=a;f<=b;f+=c){e.push(f)}return new d(e,false)};d.repeat=function(a,b){if(b==null||isNaN(b))b=1;var c=[];for(var e=0;e<b;e++){c.push(a)}return new d(c,false)};d.matches=function(a,b,c){if(b==null)throw new Error("Invalid 'pattern' value.");if(a==null)return new d([]);if(typeof a!=typeof "")throw new Error("Parameter 'text' is not a string.");if(c==null)c="";if(c.indexOf("g")<0)c+="g";var e;if(b instanceof RegExp){if(c.indexOf("i")<0&&b.ignoreCase)c+="i";if(c.indexOf("m")<0&&b.multiline)c+="m";e=b.source}else e=b;var f=new RegExp(e,c);var g=a.match(f);return new d(g==null?[]:g,false)};d.prototype={all:function(a){a=c.createLambda(a);if(a==null||!c.isFunction(a))throw new Error("Invalid predicate.");c.processDeferredSort(this);return c.every(this.array,a)},any:function(a){a=c.createLambda(a);if(a!=null&&!c.isFunction(a))throw new Error("Invalid predicate.");c.processDeferredSort(this);if(a==null)return this.array.length>0;return c.some(this.array,a)},average:function(a){a=c.createLambda(a);if(a!=null&&!c.isFunction(a))throw new Error("Invalid selector.");c.processDeferredSort(this);var b=this.array.length;var d=0;var e=0;for(var f=0;f<b;f++){if(f in this.array){var g=a==null?this.array[f]:a(this.array[f]);if(g==null)continue;if(isNaN(g))throw new Error("Encountered an element that is not a number.");d+=g;e+=1}}return d/e},concat:function(a){c.processDeferredSort(this);if(a==null)return new d(this.array);var b=d.from(a);c.processDeferredSort(b);return new d(this.array.concat(b.array),false)},contains:function(a,b){b=c.createLambda(b);if(b!=null&&!c.isFunction(b))throw new Error("Invalid comparer.");c.processDeferredSort(this);return c.some(this.array,function(c){if(b==null)return c===a;else return b(c,a)})},count:function(a){a=c.createLambda(a);if(a!=null&&!c.isFunction(a))throw new Error("Invalid predicate.");c.processDeferredSort(this);if(a==null)return this.array.length;var b=this.array.length;var d=0;for(var e=0;e<b;e++){if(e in this.array&&a(this.array[e]))d+=1}return d},defaultIfEmpty:function(a){c.processDeferredSort(this);if(this.array.length==0)return new d([a],false);else return new d(this.array)},distinct:function(a){return this.distinctBy(c.identity,a)},distinctBy:function(a,b){a=c.createLambda(a);b=c.createLambda(b);if(a==null||!c.isFunction(a))throw new Error("Invalid key selector.");if(b!=null&&!c.isFunction(b))throw new Error("Invalid comparer.");c.processDeferredSort(this);return this.groupBy(a,null,b).select(function(a){return(new d(a.values,false)).first()})},elementAt:function(a){if(a==null||isNaN(a)||a<0||a>=this.array.length)throw new Error("Invalid index.");c.processDeferredSort(this);return this.array[a]},elementAtOrDefault:function(a,b){if(a==null||isNaN(a)||a<0||a>=this.array.length)return b;c.processDeferredSort(this);return this.array[a]},except:function(a,b){b=c.createLambda(b);if(b!=null&&!c.isFunction(b))throw new Error("Invalid comparer.");c.processDeferredSort(this);if(a==null)return new d(this.array);var e=d.from(a);c.processDeferredSort(e);var f=this.array.length;var g=new d([],false);for(var h=0;h<f;h++){if(h in this.array){var i=this.array[h];var j=function(a){if(b==null)return a===i;else return b(a,i)};var k=c.some(g.array,j);var l=c.some(e.array,j);if(!k&&!l)g.array.push(i)}}return g},first:function(a){a=c.createLambda(a);if(a!=null&&!c.isFunction(a))throw new Error("Invalid predicate.");c.processDeferredSort(this);var b=this.array.length;for(var d=0;d<b;d++){if(d in this.array&&(a==null||a(this.array[d])))return this.array[d]}throw new Error("No first item was found in collection.")},firstOrDefault:function(a,b){b=c.createLambda(b);if(b!=null&&!c.isFunction(b))throw new Error("Invalid predicate.");c.processDeferredSort(this);var d=this.array.length;for(var e=0;e<d;e++){if(e in this.array&&(b==null||b(this.array[e])))return this.array[e]}return a},foreach:function(a){a=c.createLambda(a);if(a==null||!c.isFunction(a))throw new Error("Invalid action.");c.processDeferredSort(this);var b=this.array.length;for(var d=0;d<b;d++){if(d in this.array)a(this.array[d],d)}},groupBy:function(a,b,e){a=c.createLambda(a);b=c.createLambda(b);e=c.createLambda(e);if(a==null||!c.isFunction(a))throw new Error("Invalid key selector.");if(b!=null&&!c.isFunction(b))throw new Error("Invalid element selector.");if(e!=null&&!c.isFunction(e))throw new Error("Invalid key comparer.");c.processDeferredSort(this);var f=this.array.length;var g=new d([],false);for(var h=0;h<f;h++){var i=this.array[h];var j=a(i);var k=b==null?i:b(i);var l=g.firstOrDefault(null,function(a){if(e==null)return a.key===j;else return e(a.key,j)});if(l==null)g.array.push({key:j,values:[k]});else l.values.push(k)}return g},groupJoin:function(a,b,e,f,g){b=c.createLambda(b);e=c.createLambda(e);f=c.createLambda(f);g=c.createLambda(g);if(a==null)throw new Error("Invalid inner collection.");if(b==null||!c.isFunction(b))throw new Error("Invalid outer key selector.");if(e==null||!c.isFunction(e))throw new Error("Invalid inner key selector.");if(f==null||!c.isFunction(f))throw new Error("Invalid result selector.");if(g!=null&&!c.isFunction(g))throw new Error("Invalid key comparer.");c.processDeferredSort(this);var h=d.from(a);var i=h.groupBy(e,null,g);var j=this.array.length;var k=[];for(var l=0;l<j;l++){if(l in this.array){var m=this.array[l];var n=b(m);var o=i.firstOrDefault(null,function(a){if(g==null)return a.key===n;else return g(a.key,n)});k.push(f(m,o==null?[]:o.values))}}return new d(k,false)},index:function(a){if(a==null)a=0;if(isNaN(a))throw new Error("Invalid startIndex");return this.select(function(b,c){return{key:a+c,value:b}})},intersect:function(a,b){if(a==null)return new d([],false);b=c.createLambda(b);var e=d.from(a);c.processDeferredSort(e);if(b!=null&&!c.isFunction(b))throw new Error("Invalid comparer.");c.processDeferredSort(this);var f=this.array.length;var g=new d([],false);for(var h=0;h<f;h++){if(h in this.array){var i=this.array[h];var j=function(a){if(b==null)return a===i;else return b(a,i)};var k=c.some(g.array,j);var l=c.some(e.array,j);if(!k&&l)g.array.push(i)}}return g},join:function(a,b,e,f,g){b=c.createLambda(b);e=c.createLambda(e);f=c.createLambda(f);g=c.createLambda(g);if(a==null)throw new Error("Invalid inner collection.");if(b==null||!c.isFunction(b))throw new Error("Invalid outer key selector.");if(e==null||!c.isFunction(e))throw new Error("Invalid inner key selector.");if(f==null||!c.isFunction(f))throw new Error("Invalid result selector.");if(g!=null&&!c.isFunction(g))throw new Error("Invalid key comparer.");c.processDeferredSort(this);var h=d.from(a);var i=h.groupBy(e,null,g);var j=this.array.length;var k=[];for(var l=0;l<j;l++){if(l in this.array){var m=this.array[l];var n=b(m);var o=i.firstOrDefault(null,function(a){if(g==null)return a.key===n;else return g(a.key,n)});if(o!=null&&o.values.length>0){var p=o.values.length;for(var q=0;q<p;q++){k.push(f(m,o.values[q]))}}}}return new d(k,false)},last:function(a){a=c.createLambda(a);if(a!=null&&!c.isFunction(a))throw new Error("Invalid predicate.");c.processDeferredSort(this);for(var b=this.array.length-1;b>=0;b--){if(b in this.array&&(a==null||a(this.array[b])))return this.array[b]}throw new Error("No last item was found in collection.")},lastOrDefault:function(a,b){b=c.createLambda(b);if(b!=null&&!c.isFunction(b))throw new Error("Invalid predicate.");c.processDeferredSort(this);for(var d=this.array.length-1;d>=0;d--){if(d in this.array&&(b==null||b(this.array[d])))return this.array[d]}return a},min:function(a){if(this.array.length==0)throw new Error("No minimum element.");a=c.createLambda(a);if(a!=null&&!c.isFunction(a))throw new Error("Invalid selector.");c.processDeferredSort(this);var b=this.array.length;var d=a==null?this.array[0]:a(this.array[0]);for(var e=1;e<b;e++){if(e in this.array){var f=a==null?this.array[e]:a(this.array[e]);if(f<d)d=f}}return d},minBy:function(a){if(this.array.length==0)throw new Error("No mininum element.");a=c.createLambda(a);if(a==null||!c.isFunction(a))throw new Error("Invalid selector.");c.processDeferredSort(this);var b=this.array.length;var d=a(this.array[0]);var e=this.array[0];for(var f=1;f<b;f++){if(f in this.array){var g=this.array[f];var h=a(g);if(h<d){d=h;e=g}}}return e},max:function(a){if(this.array.length==0)throw new Error("No maximum element.");a=c.createLambda(a);if(a!=null&&!c.isFunction(a))throw new Error("Invalid selector.");c.processDeferredSort(this);var b=this.array.length;var d=a==null?this.array[0]:a(this.array[0]);for(var e=1;e<b;e++){if(e in this.array){var f=a==null?this.array[e]:a(this.array[e]);if(f>d)d=f}}return d},maxBy:function(a){if(this.array.length==0)throw new Error("No maximum element.");a=c.createLambda(a);if(a==null||!c.isFunction(a))throw new Error("Invalid selector.");c.processDeferredSort(this);var b=this.array.length;var d=a(this.array[0]);var e=this.array[0];for(var f=1;f<b;f++){if(f in this.array){var g=this.array[f];var h=a(g);if(h>d){d=h;e=g}}}return e},orderBy:function(a,b){a=c.createLambda(a);b=c.createLambda(b);if(a==null||!c.isFunction(a))throw new Error("Invalid key selector.");if(b!=null&&!c.isFunction(b))throw new Error("Invalid comparer.");if(b==null)b=function(a,b){return a-b};c.processDeferredSort(this);var e=new d(this.array);e.deferredSort={keySelector:a,comparer:b,reverse:false,next:null};return e},orderByDescending:function(a,b){a=c.createLambda(a);b=c.createLambda(b);if(a==null||!c.isFunction(a))throw new Error("Invalid key selector.");if(b!=null&&!c.isFunction(b))throw new Error("Invalid comparer.");if(b==null)b=function(a,b){return a-b};c.processDeferredSort(this);var e=new d(this.array);e.deferredSort={keySelector:a,comparer:b,reverse:true,next:null};return e},reverse:function(){c.processDeferredSort(this);return new d(this.array.reverse(),false)},select:function(a){a=c.createLambda(a);if(a==null||!c.isFunction(a))throw new Error("Invalid selector.");c.processDeferredSort(this);return new d(c.map(this.array,a),false)},selectMany:function(a,b){a=c.createLambda(a);b=c.createLambda(b);if(a==null||!c.isFunction(a))throw new Error("Invalid collection selector.");if(b!=null&&!c.isFunction(b))throw new Error("Invalid result selector.");c.processDeferredSort(this);var e=this.array.length;var f=[];for(var g=0;g<e;g++){var h=this.array[g];var i=a(h,g);if(!c.isArray(i))i=d.from(i).toArray();if(i!=null&&i.length>0){var j=i.length;for(var k=0;k<j;k++){var l=i[k];var m=b==null?l:b(l,h);f.push(m)}}}return new d(f,false)},sequenceEquals:function(a,b){if(a==null)return false;b=c.createLambda(b);if(b!=null&&!c.isFunction(b))throw new Error("Inavlid comparer.");c.processDeferredSort(this);var e=d.from(a);c.processDeferredSort(e);if(this.array.length!=e.array.length)return false;var f=this.array.length;var g=e.array.length;for(var h=0;h<f;h++){var i=false;for(var j=0;j<g;j++){if(b==null)i=this.array[h]===e.array[j];else i=b(this.array[h],e.array[j]);if(i)break}if(!i)return false}return true},single:function(a){a=c.createLambda(a);if(a==null){if(this.array.length==0)throw new Error("No single item in the collection.");if(this.array.length>1)throw new Error("More than one item in the collection.");c.processDeferredSort(this);return this.array[0]}if(!c.isFunction(a))throw new Error("Invalid predicate.");c.processDeferredSort(this);var b=this.array.length;var d=false;var e=null;for(var f=0;f<b;f++){if(f in this.array&&a(this.array[f])){if(d)throw new Error("More than one item matched the predicate in the collection.");d=true;e=this.array[f]}}if(!d)throw new Error("No single item matched the predicate in the collection.");return e},singleOrDefault:function(a,b){b=c.createLambda(b);if(b==null){if(this.array.length==0)return a;if(this.array.length>1)throw new Error("More than one item in the collection.");c.processDeferredSort(this);return this.array[0]}if(!c.isFunction(b))throw new Error("Invalid predicate.");c.processDeferredSort(this);var d=this.array.length;var e=false;var f=null;for(var g=0;g<d;g++){if(g in this.array&&b(this.array[g])){if(e)throw new Error("More than one item matched the predicate in the collection.");e=true;f=this.array[g]}}return e?f:a},skip:function(a){if(a==null||isNaN(a))throw new Error("Invalid count.");c.processDeferredSort(this);return new d(this.array.slice(a),false)},skipUntil:function(a){a=c.createLambda(a);if(a==null||!c.isFunction(a))throw new Error("Invalid predicate");return this.skipWhile(function(b){return!a(b)})},skipWhile:function(a){a=c.createLambda(a);if(a==null||!c.isFunction(a))throw new Error("Invalid predicate.");c.processDeferredSort(this);var b=this.array.length;var e=[];var f=true;for(var g=0;g<b;g++){var h=this.array[g];if(!f)e.push(h);else if(!a(h)){f=false;e.push(h)}}return new d(e,false)},sum:function(a){c.processDeferredSort(this);if(this.array.length==0)return 0;a=c.createLambda(a);if(a!=null&&!c.isFunction(a))throw new Error("Invalid selector.");var b=this.array.length;var d=0;for(var e=0;e<b;e++){if(e in this.array){var f=a==null?this.array[e]:a(this.array[e]);if(f!=null)d+=f}}return d},take:function(a){if(a==null||isNaN(a))throw new Error("Invalid count.");c.processDeferredSort(this);return new d(this.array.slice(0,a),false)},takeEvery:function(a){if(a==null||isNaN(a))throw new Error("Invalid count.");c.processDeferredSort(this);return this.where(function(b,c){return c%a==0})},takeLast:function(a){if(a==null||isNaN(a))throw new Error("Invalid count.");c.processDeferredSort(this);if(a<=0)return new d([],false);if(a>this.array.length)a=this.array.length;return new d(this.array.slice(this.array.length-a),false)},takeUntil:function(a){a=c.createLambda(a);if(a==null||!c.isFunction(a))throw new Error("Invalid predicate");return this.takeWhile(function(b){return!a(b)})},takeWhile:function(a){a=c.createLambda(a);if(a==null||!c.isFunction(a))throw new Error("Invalid predicate.");c.processDeferredSort(this);var b=this.array.length;var e=[];var f=true;for(var g=0;g<b&&f;g++){var h=this.array[g];if(!a(h))f=false;else e.push(h)}return new d(e,false)},thenBy:function(a,b){a=c.createLambda(a);b=c.createLambda(b);if(a==null||!c.isFunction(a))throw new Error("Invalid key selector.");if(b!=null&&!c.isFunction(b))throw new Error("Invalid comparer.");if(this.deferredSort==null)throw new Error("ThenBy can only be called following an OrderBy/OrderByDescending.");if(b==null)b=function(a,b){return a-b};var e=new d(this.array);e.deferredSort=c.extendDeferredSort(this.deferredSort,{keySelector:a,comparer:b,reverse:false,next:null});return e},thenByDescending:function(a,b){a=c.createLambda(a);b=c.createLambda(b);if(a==null||!c.isFunction(a))throw new Error("Invalid key selector.");if(b!=null&&!c.isFunction(b))throw new Error("Invalid comparer.");if(this.deferredSort==null)throw new Error("ThenByDescending can only be called following an OrderBy/OrderByDescending.");if(b==null)b=function(a,b){return a-b};var e=new d(this.array);e.deferredSort=c.extendDeferredSort(this.deferredSort,{keySelector:a,comparer:b,reverse:true,next:null});return e},toDelimitedString:function(a){if(a==null)a=",";c.processDeferredSort(this);return this.array.join(a)},toDictionary:function(a,b){a=c.createLambda(a);b=c.createLambda(b);if(a==null||!c.isFunction(a))throw new Error("Invalid key selector.");if(b!=null&&!c.isFunction(b))throw new Error("Invalid element selector.");c.processDeferredSort(this);var d=this.array.length;var e={};for(var f=0;f<d;f++){var g=this.array[f];var h=a(g);if(h in e)throw new Error("Duplicate key in collection.");e[h]=b==null?g:b(g)}return e},union:function(a,b){b=c.createLambda(b);if(b!=null&&!c.isFunction(b))throw new Error("Invalid comparer.");c.processDeferredSort(this);var e=d.from(a==null?[]:a);c.processDeferredSort(e);var f=this.array.length;var g=new d([],false);for(var h=0;h<f;h++){if(h in this.array){var i=this.array[h];var j=c.some(g.array,function(a){if(b==null)return a===i;else return b(a,i)});if(!j)g.array.push(i)}}f=e.array.length;for(var h=0;h<f;h++){if(h in e.array){var i=e.array[h];var j=c.some(g.array,function(a){if(b==null)return a===i;else return b(a,i)});if(!j)g.array.push(i)}}return g},where:function(a){a=c.createLambda(a);if(a==null||!c.isFunction(a))throw new Error("Invalid predicate.");c.processDeferredSort(this);return new d(c.filter(this.array,a),false)},zip:function(a,b){b=c.createLambda(b);if(b==null||!c.isFunction(b))throw new Error("Invalid result selector.");c.processDeferredSort(this);if(a==null)return new d([],false);var e=d.from(a);c.processDeferredSort(e);var f=Math.min(this.array.length,e.array.length);var g=[];for(var h=0;h<f;h++){g.push(b(this.array[h],e.array[h]))}return new d(g,false)},toArray:function(){c.processDeferredSort(this);return this.array.slice(0)}};a.linq=d;a.$linq=d.from})(window)